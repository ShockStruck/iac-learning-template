---
# yaml-language-server: $schema=https://taskfile.dev/schema.json
# README generation and documentation tasks
version: '3'

tasks:
  generate:
    desc: "ğŸ“ Generate README.md from template"
    cmds:
      - |
        echo "ğŸ“ Generating README.md..."
        
        # For now, README is already created
        # Future enhancement: could use templates + data injection
        
        if [[ -f "{{.ROOT_DIR}}/README.md" ]]; then
          echo "âœ… README.md exists"
          
          # Validate markdown syntax
          if command -v markdownlint >/dev/null 2>&1; then
            markdownlint "{{.ROOT_DIR}}/README.md" --fix || echo "âš ï¸  Markdown linting issues"
          fi
          
          # Count sections
          sections=$(grep -c "^##" "{{.ROOT_DIR}}/README.md" || echo "0")
          echo "ğŸ“Š README sections: $sections"
        else
          echo "âŒ README.md missing"
        fi
        
  docs:generate:
    desc: "ğŸ“– Generate all documentation"
    cmds:
      - task: generate
      - task: docs:validate
      
  docs:validate:
    desc: "âœ… Validate documentation completeness"
    cmds:
      - |
        echo "âœ… Validating documentation..."
        
        REQUIRED_DOCS="
          README.md
          docs/01-iac-basics.md
          docs/02-secrets-management.md
          docs/03-docker-compose.md
          docs/04-automation-patterns.md
        "
        
        missing=0
        for doc in $REQUIRED_DOCS; do
          if [[ -f "{{.ROOT_DIR}}/$doc" ]]; then
            echo "âœ… $doc"
          else
            echo "âŒ $doc (missing)"
            missing=1
          fi
        done
        
        if [[ $missing -eq 0 ]]; then
          echo ""
          echo "ğŸ‰ All documentation present"
        else
          echo ""
          echo "âš ï¸  Some documentation missing"
        fi
        
  serve:
    desc: "ğŸŒ Serve documentation locally"
    cmds:
      - |
        echo "ğŸŒ Starting documentation server..."
        echo "ğŸ”— URL: http://localhost:8000"
        echo "â¸ï¸  Press Ctrl+C to stop"
        echo ""
        cd {{.ROOT_DIR}} && python3 -m http.server 8000
